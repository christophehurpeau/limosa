{"version":3,"sources":["../../src/RouterBuilder.js"],"names":[],"mappings":"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","file":"RouterBuilder.js","sourcesContent":["import object2map from 'object2map';\nimport Router from './Router';\n// import RouterRouteCommon from './RouterRoute/Common';\nimport RouterRoute from './RouterRoute/Route';\nimport RouterRouteSegment from './RouterRoute/Segment';\nimport RouterRouteLang from './RouterRoute/Lang';\nimport UrlGenerator from './UrlGenerator/UrlGenerator';\nimport UrlGeneratorNamedParamPart from './UrlGenerator/UrlGeneratorNamedParamPart';\nimport UrlGeneratorOptionalGroupPart from './UrlGenerator/UrlGeneratorOptionalGroupPart';\nimport UrlGeneratorPartArray from './UrlGenerator/UrlGeneratorPartArray';\nimport UrlGeneratorStringPart from './UrlGenerator/UrlGeneratorStringPart';\n\n// const regExpStartingSlash = /^\\/+/;\n// const regExpEndingSlash = /\\/+$/;\n\n/**\n * Build a route segment\n */\nclass RouterBuilderSegment {\n    /**\n     * @param {RouterBuilder} builder\n     * @param {RouterRouteSegment} route\n     * @param {RouterRouteSegment} [parent]\n     */\n    constructor(builder, route, parent) {\n        this.builder = builder;\n        this.route = route;\n        this.parent = parent;\n    }\n\n    /**\n     * @param {string} routeKey\n     * @param {string} routeUrl\n     * @param {string} controllerAndActionSeparatedByDot\n     * @param {Map} options.namedParamsDefinition\n     * @param {Map} options.routeLangs\n     * @param {string} options.extension\n     */\n    add(routeKey, routeUrl, controllerAndActionSeparatedByDot, options) {\n        const route = this._createRoute(routeKey, routeUrl, controllerAndActionSeparatedByDot, options);\n        this.route.subRoutes.push(route);\n        this.builder.router._addInternalRoute(routeKey, route);\n        return this;\n    }\n\n    /**\n     * @param {string} routeKey\n     * @param {string} routeUrl\n     * @param {string} controllerAndActionSeparatedByDot\n     * @param {Map} options.namedParamsDefinition\n     * @param {Map} options.routeLangs\n     * @param {string} options.extension\n     */\n    _createRoute(routeKey, routeUrl, controllerAndActionSeparatedByDot, options) {\n        return this.builder._createRoute(false, this.route, routeUrl,\n                            controllerAndActionSeparatedByDot,\n                            options && options.namedParamsDefinition,\n                            options && options.routeLangs,\n                            options && options.extension);\n    }\n\n    /**\n     * @param {string} routeKey\n     * @param {string} controllerAndActionSeparatedByDot\n     * @param {Map} options.namedParamsDefinition\n     * @param {Map} options.routeLangs\n     * @param {string} options.extension\n     */\n    defaultRoute(routeKey, controllerAndActionSeparatedByDot, options) {\n        const route = this._createRoute(routeKey, '', controllerAndActionSeparatedByDot, options);\n        // this.route.defaultRoute = route;\n        // this.builder.router._addInternalRoute(routeKey, route);\n        this.route.subRoutes.push(route);\n        this.builder.router._addInternalRoute(routeKey, route);\n        return this;\n    }\n\n    /**\n     * @param {string} routeUrl\n     * @param {Map} [options.namedParamsDefinition]\n     * @param {Map} [options.routeLangs]\n     * @param {Function} buildSegment\n     */\n    addSegment(routeUrl, options, buildSegment) {\n        if (typeof options === 'function') {\n            buildSegment = options;\n            options = {};\n        }\n\n        const route = this.builder._createRouteSegment(this.route, routeUrl,\n                            options.namedParamsDefinition, options.routeLangs);\n        const segment = new RouterBuilderSegment(this.buider, route, this.route);\n        buildSegment(segment);\n        this.router.addRoute(null, route);\n    }\n}\n\nexport default class RouterBuilder {\n    /**\n     * @param {RoutesTranslations} routesTranslations\n     * @param {Array} allLangs Array of all langs\n     */\n    constructor(routesTranslations, allLangs) {\n        this._routesTranslations = routesTranslations;\n        this._allLangs = allLangs;\n        this.router = new Router(routesTranslations);\n\n        this.regExpNamedParam = /\\$\\{([a-zA-Z]+)}/g;\n        this.translatableRoutePart = /\\/([a-zA-Z_]+)/g;\n        this.translatableRouteNamedParamValue = /^[a-zA-Z\\|_]+$/g;\n        this.regExpNamedParamOrOptionalPart = /(?:\\$\\{([a-zA-Z]+)})|(?:\\[([^\\]]+)\\])/g;\n    }\n\n    /**\n     * @param {string} lang\n     * @param {string} string\n     * @return {string}\n     */\n    translate(lang, string) {\n        const lstring = string.toLowerCase();\n        const translation = this._routesTranslations.translate(lstring, lang);\n        return translation;\n    }\n\n    /**\n     * @param {Map} routes\n     */\n    fromMap(routes) {\n        routes.forEach((route, routeKey) => {\n            this.add(routeKey, routeKey, route[0], {\n                namedParamsDefinition: route.length > 1 ? route[1] : undefined,\n                routeLangs: route.length > 2 ? (route[2] || {}) : {},\n                extension: route.length > 3 ? route[3] : undefined,\n            });\n        });\n    }\n\n    /**\n     * @param {string} routeKey\n     * @param {string} routeUrl\n     * @param {string} controllerAndActionSeparatedByDot\n     * @param {Map} options.namedParamsDefinition\n     * @param {Map} options.routeLangs\n     * @param {string} options.extension\n     */\n    add(routeKey, routeUrl, controllerAndActionSeparatedByDot, options) {\n        const route = this._createRoute(false, undefined, routeUrl, controllerAndActionSeparatedByDot,\n                            options && options.namedParamsDefinition,\n                            options && options.routeLangs,\n                            options && options.extension);\n        this.router.addRoute(routeKey, route);\n        return this;\n    }\n\n    /**\n     * @param {string} routeUrl\n     * @param {Map} [options.namedParamsDefinition]\n     * @param {Map} [options.routeLangs]\n     * @param {Function} buildSegment\n     */\n    addSegment(routeUrl, options, buildSegment) {\n        if (typeof options === 'function') {\n            buildSegment = options;\n            options = {};\n        }\n\n        const route = this._createRouteSegment(undefined, routeUrl,\n                            options.namedParamsDefinition, options.routeLangs);\n        const segment = new RouterBuilderSegment(this, route, undefined);\n        buildSegment(segment);\n        this.router.addRoute(undefined, route);\n        return this;\n    }\n\n    /**\n     * @param {RouterRouteSegment} parent\n     * @param {string} routeUrl\n     * @param {Map} namedParamsDefinition\n     * @param {Map} routeLangs\n     * @return {RouterRouteCommon}\n     */\n    _createRouteSegment(parent, routeUrl, namedParamsDefinition, routeLangs) {\n        return this._createRoute(true, parent, routeUrl, undefined, namedParamsDefinition, routeLangs, undefined);\n    }\n\n    /**\n     * @param {boolean} segment\n     * @param {RouterRouteSegment} parent\n     * @param {string} routeUrl\n     * @param {string} controllerAndActionSeparatedByDot\n     * @param {Map} namedParamsDefinition\n     * @param {Map} routeLangs\n     * @param {string} extension\n     * @return {RouterRouteCommon}\n     */\n    _createRoute(segment, parent, routeUrl, controllerAndActionSeparatedByDot,\n                        namedParamsDefinition, routeLangs, extension) {\n        let controllerAndAction;\n        if (!segment) {\n            controllerAndAction = controllerAndActionSeparatedByDot.split('.');\n            // assert(controllerAndAction.length == 2);\n        }\n\n        if (routeLangs == null) {\n            routeLangs = new Map();\n        } else {\n            routeLangs = object2map(routeLangs);\n        }\n\n        // -- Route langs --\n\n        if (routeLangs.size !== 0) {\n            this._allLangs.forEach((lang) => {\n                if (!routeLangs.has(lang)) {\n                    if (lang == 'en') {\n                        routeLangs.set('en', routeUrl);\n                    } else {\n                        throw new Error(`Missing lang ${lang}\" for route \"${routeUrl}\"`);\n                    }\n                }\n            });\n        } else if (!routeUrl.match(this.translatableRoutePart)) {\n            this._allLangs.forEach((lang) => {\n                routeLangs.set(lang, routeUrl);\n            });\n        } else {\n            this._allLangs.forEach(lang => {\n                routeLangs.set(\n                    lang,\n                    routeUrl.replace(\n                        this.translatableRoutePart,\n                        (str, p1) => `/${this.translate(lang, p1)}`)\n                );\n            });\n        }\n\n        const paramNames = [];\n        routeLangs.get(this._allLangs[0]).replace(this.regExpNamedParam, (str, paramName) => {\n            paramNames.push(paramName);\n        });\n        // console.log(routeLangs[this._allLangs[0]], paramNames);\n\n        const finalRoute = segment ? new RouterRouteSegment(paramNames)\n            : new RouterRoute(controllerAndAction[0], controllerAndAction[1], extension, paramNames);\n\n        routeLangs.forEach((routeLang, lang) => {\n            const translate = this.translate.bind(this, lang);\n            let specialEnd = false;\n            let specialEnd2 = false;\n            let routeLangRegExp;\n\n            if (!segment && (specialEnd = routeLang.endsWith('/*'))) {\n                routeLangRegExp = routeLang.slice(0, -2);\n            } else if (!segment && (specialEnd2 = routeLang.endsWith('/*]'))) {\n                routeLangRegExp = routeLang.slice(0, -3) + routeLang.slice(-1);\n            } else {\n                routeLangRegExp = routeLang;\n            }\n\n            routeLangRegExp = routeLangRegExp\n                .replace(/\\//g, '\\\\/')\n                .replace(/\\-/g, '\\\\-')\n                .replace(/\\*/g, '(.*)')\n                .replace(/\\[/g, '(')\n                .replace(/]/g, ')')\n                .replace(/\\(/g, '(?:');\n\n            if (specialEnd) {\n                routeLangRegExp = `${routeLangRegExp}(?:\\\\/([^.]*))?`;\n            } else if (specialEnd2) {\n                // ends now is : /*)?\n                routeLangRegExp = `${routeLangRegExp.slice(0, -2)}(?:\\\\/(.*))?${routeLangRegExp.slice(-2)}`;\n            }\n\n            const extensionRegExp = (() => {\n                if (segment || extension == null) {\n                    return '';\n                }\n\n                if (extension == 'html') {\n                    return '(?:\\\\.(html))?';\n                }\n\n                return `\\\\.(${extension})`;\n            })();\n\n            const replacedRegExp = routeLangRegExp.replace(this.regExpNamedParam, (str, paramName) => {\n                if (namedParamsDefinition && namedParamsDefinition[paramName]) {\n                    let paramDefVal = namedParamsDefinition[paramName];\n                    if (typeof paramDefVal === 'string') {\n                        if (paramDefVal.match(this.translatableRouteNamedParamValue)) {\n                            paramDefVal = paramDefVal.split('|').map(translate).join('|');\n                        }\n                    } else if (paramDefVal instanceof RegExp) {\n                        paramDefVal = paramDefVal.source;\n                    } else {\n                        paramDefVal = paramDefVal[lang];\n                    }\n\n                    return paramDefVal == 'id' ? '([0-9]+)' : `(${paramDefVal.replace('(', '(?:')})`;\n                }\n\n                if (paramName === 'id') {\n                    return '([0-9]+)';\n                }\n\n                return '([^\\\\/.]+)';\n            });\n\n            if (!segment && specialEnd) {\n                routeLang = routeLang.slice(0, -2);\n            } else if (!segment && specialEnd2) {\n                routeLang = routeLang.slice(0, -3) + routeLang.slice(-1);\n            }\n\n            const regExpNamedParamOrOptionalPart = this.regExpNamedParamOrOptionalPart;\n            const parts = routeLang.length === 0 ? null : (function buildParts(routeLangPart) {\n                const parts = [];\n                let index = 0;\n                routeLangPart.replace(regExpNamedParamOrOptionalPart, (match, paramName, optionalGroup, offset) => {\n                    if (offset > index) {\n                        parts.push(new UrlGeneratorStringPart(routeLang.substring(index, offset)));\n                    }\n\n                    index = offset + match.length;\n\n                    if (optionalGroup) {\n                        const optionalGroupParts = buildParts(optionalGroup);\n                        parts.push(new UrlGeneratorOptionalGroupPart(optionalGroupParts));\n                    } else {\n                        parts.push(new UrlGeneratorNamedParamPart(paramName, translate));\n                    }\n\n                    return match;\n                });\n\n                if (index < routeLangPart.length) {\n                    parts.push(new UrlGeneratorStringPart(routeLang.substring(index)));\n                }\n\n                if (parts.length === 0) {\n                    throw new Error(routeLangPart);\n                }\n\n                return new UrlGeneratorPartArray(parts);\n            }(routeLang));\n\n            let urlGeneratorParts;\n            if (parent != null) {\n                const parentParts = parent.routes.get(lang).urlGenerator.parts;\n                const mergedParts = parts === null ? parentParts : new UrlGeneratorPartArray([parentParts, parts]);\n                urlGeneratorParts = new UrlGenerator(mergedParts, extension);\n            } else {\n                urlGeneratorParts = new UrlGenerator(parts, extension);\n            }\n\n            finalRoute.set(lang, new RouterRouteLang(\n                new RegExp(`^${replacedRegExp}${extensionRegExp}${segment ? '(.*)$' : '$'}`),\n                urlGeneratorParts\n            ));\n        });\n\n        return finalRoute;\n    }\n\n    /**\n     * Add default routes\n     */\n    addDefaultRoutes() {\n        this.addSegment('/${controller}', { extension: 'html' }, (segment) => {\n            segment\n                .add('default', '/${action}/*', 'site.index', { extension: 'html' })\n                .defaultRoute('defaultSimple', 'site.index', { extension: 'html' });\n        });\n\n        return this;\n    }\n}\n"]}