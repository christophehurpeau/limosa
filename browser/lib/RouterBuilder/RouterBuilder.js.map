{"version":3,"sources":["../../../src/RouterBuilder/RouterBuilder.js"],"names":[],"mappings":"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","file":"RouterBuilder.js","sourcesContent":["import object2map from 'object2map';\nimport Router from '../Router';\n// import RouterRouteCommon from '../RouterRoute/Common';\nimport RouterRoute from '../RouterRoute/Route';\nimport RouterRouteSegment from '../RouterRoute/Segment';\nimport RouterRouteLang from '../RouterRoute/Lang';\nimport UrlGenerator from '../UrlGenerator/UrlGenerator';\nimport UrlGeneratorNamedParamPart from '../UrlGenerator/UrlGeneratorNamedParamPart';\nimport UrlGeneratorOptionalGroupPart from '../UrlGenerator/UrlGeneratorOptionalGroupPart';\nimport UrlGeneratorPartArray from '../UrlGenerator/UrlGeneratorPartArray';\nimport UrlGeneratorStringPart from '../UrlGenerator/UrlGeneratorStringPart';\nimport RouterBuilderSegment from './RouterBuilderSegment';\n\n// const regExpStartingSlash = /^\\/+/;\n// const regExpEndingSlash = /\\/+$/;\n\n\nexport default class RouterBuilder {\n    /**\n     * @param {RoutesTranslations} routesTranslations\n     * @param {Array} allLangs Array of all langs\n     */\n    constructor(routesTranslations, allLangs) {\n        this._routesTranslations = routesTranslations;\n        this._allLangs = allLangs;\n        this.router = new Router(routesTranslations);\n\n        this.regExpNamedParam = /\\$\\{([a-zA-Z]+)}/g;\n        this.translatableRoutePart = /\\/([a-zA-Z_]+)/g;\n        this.translatableRouteNamedParamValue = /^[a-zA-Z\\|_]+$/g;\n        this.regExpNamedParamOrOptionalPart = /(?:\\$\\{([a-zA-Z]+)})|(?:\\[([^\\]]+)\\])/g;\n    }\n\n    /**\n     * @param {string} lang\n     * @param {string} string\n     * @return {string}\n     */\n    translate(lang, string) {\n        const lstring = string.toLowerCase();\n        const translation = this._routesTranslations.translate(lstring, lang);\n        return translation;\n    }\n\n    /**\n     * @param {Map} routes\n     */\n    fromMap(routes) {\n        routes.forEach((route, routeKey) => {\n            this.add(routeKey, routeKey, route[0], {\n                namedParamsDefinition: route.length > 1 ? route[1] : undefined,\n                routeLangs: route.length > 2 ? (route[2] || {}) : {},\n                extension: route.length > 3 ? route[3] : undefined,\n            });\n        });\n    }\n\n    /**\n     * @param {string} routeKey\n     * @param {string} routeUrl\n     * @param {string} controllerAndActionSeparatedByDot\n     * @param {Map} options.namedParamsDefinition\n     * @param {Map} options.routeLangs\n     * @param {string} options.extension\n     */\n    add(routeKey, routeUrl, controllerAndActionSeparatedByDot, options) {\n        const route = this._createRoute(\n            false,\n            undefined,\n            routeUrl,\n            controllerAndActionSeparatedByDot,\n            options && options.namedParamsDefinition,\n            options && options.routeLangs,\n            options && options.extension\n        );\n        this.router.addRoute(routeKey, route);\n        return this;\n    }\n\n    /**\n     * @param {string} routeUrl\n     * @param {Map} [options.namedParamsDefinition]\n     * @param {Map} [options.routeLangs]\n     * @param {Function} buildSegment\n     */\n    addSegment(routeUrl, options, buildSegment) {\n        if (typeof options === 'function') {\n            buildSegment = options;\n            options = {};\n        }\n\n        const route = this._createRouteSegment(undefined, routeUrl,\n                            options.namedParamsDefinition, options.routeLangs);\n        const segment = new RouterBuilderSegment(this, route, undefined);\n        buildSegment(segment);\n        this.router.addRoute(undefined, route);\n        return this;\n    }\n\n    /**\n     * @param {RouterRouteSegment} parent\n     * @param {string} routeUrl\n     * @param {Map} namedParamsDefinition\n     * @param {Map} routeLangs\n     * @return {RouterRouteCommon}\n     */\n    _createRouteSegment(parent, routeUrl, namedParamsDefinition, routeLangs) {\n        return this._createRoute(\n            true,\n            parent,\n            routeUrl,\n            undefined,\n            namedParamsDefinition,\n            routeLangs,\n            undefined\n        );\n    }\n\n    /**\n     * @param {boolean} segment\n     * @param {RouterRouteSegment} parent\n     * @param {string} routeUrl\n     * @param {string} controllerAndActionSeparatedByDot\n     * @param {Map} namedParamsDefinition\n     * @param {Map} routeLangs\n     * @param {string} extension\n     * @return {RouterRouteCommon}\n     */\n    _createRoute(segment, parent, routeUrl, controllerAndActionSeparatedByDot,\n                        namedParamsDefinition, routeLangs, extension) {\n        let controllerAndAction;\n        if (!segment) {\n            controllerAndAction = controllerAndActionSeparatedByDot.split('.');\n            // assert(controllerAndAction.length == 2);\n        }\n\n        if (routeLangs == null) {\n            routeLangs = new Map();\n        } else {\n            routeLangs = object2map(routeLangs);\n        }\n\n        // -- Route langs --\n\n        if (routeLangs.size !== 0) {\n            this._allLangs.forEach((lang) => {\n                if (!routeLangs.has(lang)) {\n                    if (lang === 'en') {\n                        routeLangs.set('en', routeUrl);\n                    } else {\n                        throw new Error(`Missing lang ${lang}\" for route \"${routeUrl}\"`);\n                    }\n                }\n            });\n        } else if (!routeUrl.match(this.translatableRoutePart)) {\n            this._allLangs.forEach((lang) => {\n                routeLangs.set(lang, routeUrl);\n            });\n        } else {\n            this._allLangs.forEach(lang => {\n                routeLangs.set(\n                    lang,\n                    routeUrl.replace(\n                        this.translatableRoutePart,\n                        (str, p1) => `/${this.translate(lang, p1)}`)\n                );\n            });\n        }\n\n        const paramNames = [];\n        routeLangs.get(this._allLangs[0]).replace(this.regExpNamedParam, (str, paramName) => {\n            paramNames.push(paramName);\n        });\n\n        const finalRoute = segment ? new RouterRouteSegment(paramNames)\n            : new RouterRoute(controllerAndAction[0], controllerAndAction[1], extension, paramNames);\n\n        routeLangs.forEach((routeLang, lang) => {\n            const translate = this.translate.bind(this, lang);\n            let specialEnd = false;\n            let specialEnd2 = false;\n            let routeLangRegExp;\n\n            if (!segment && (specialEnd = routeLang.endsWith('/*'))) {\n                routeLangRegExp = routeLang.slice(0, -2);\n            } else if (!segment && (specialEnd2 = routeLang.endsWith('/*]'))) {\n                routeLangRegExp = routeLang.slice(0, -3) + routeLang.slice(-1);\n            } else {\n                routeLangRegExp = routeLang;\n            }\n\n            routeLangRegExp = routeLangRegExp\n                .replace(/\\//g, '\\\\/')\n                .replace(/\\-/g, '\\\\-')\n                .replace(/\\*/g, '(.*)')\n                .replace(/\\[/g, '(')\n                .replace(/]/g, ')?')\n                .replace(/\\(/g, '(?:');\n\n            if (specialEnd) {\n                routeLangRegExp = `${routeLangRegExp}(?:\\\\/([^.]*))?`;\n            } else if (specialEnd2) {\n                // ends now is : /*)?\n                routeLangRegExp = `${routeLangRegExp.slice(0, -2)}(?:\\\\/(.*))?${routeLangRegExp.slice(-2)}`;\n            }\n\n            const extensionRegExp = (() => {\n                if (segment || extension == null) {\n                    return '';\n                }\n\n                if (extension === 'html') {\n                    return '(?:\\\\.(html))?';\n                }\n\n                return `\\\\.(${extension})`;\n            })();\n\n            const replacedRegExp = routeLangRegExp.replace(this.regExpNamedParam, (str, paramName) => {\n                if (namedParamsDefinition && namedParamsDefinition[paramName]) {\n                    let paramDefVal = namedParamsDefinition[paramName];\n                    if (typeof paramDefVal === 'string') {\n                        if (paramDefVal.match(this.translatableRouteNamedParamValue)) {\n                            paramDefVal = paramDefVal.split('|').map(translate).join('|');\n                        }\n                    } else if (paramDefVal instanceof RegExp) {\n                        paramDefVal = paramDefVal.source;\n                    } else {\n                        paramDefVal = paramDefVal[lang];\n                    }\n\n                    return paramDefVal === 'id' ? '([0-9]+)' : `(${paramDefVal.replace('(', '(?:')})`;\n                }\n\n                if (paramName === 'id') {\n                    return '([0-9]+)';\n                }\n\n                return '([^\\\\/.]+)';\n            });\n\n            if (!segment && specialEnd) {\n                routeLang = routeLang.slice(0, -2);\n            } else if (!segment && specialEnd2) {\n                routeLang = routeLang.slice(0, -3) + routeLang.slice(-1);\n            }\n\n            const regExpNamedParamOrOptionalPart = this.regExpNamedParamOrOptionalPart;\n            const parts = routeLang.length === 0 ? null : (function buildParts(routeLangPart) {\n                const parts = [];\n                let index = 0;\n                routeLangPart.replace(\n                    regExpNamedParamOrOptionalPart,\n                    (match, paramName, optionalGroup, offset) => {\n                        if (offset > index) {\n                            parts.push(new UrlGeneratorStringPart(routeLang.substring(index, offset)));\n                        }\n\n                        index = offset + match.length;\n\n                        if (optionalGroup) {\n                            const optionalGroupParts = buildParts(optionalGroup);\n                            parts.push(new UrlGeneratorOptionalGroupPart(optionalGroupParts));\n                        } else {\n                            parts.push(new UrlGeneratorNamedParamPart(paramName, translate));\n                        }\n\n                        return match;\n                    }\n                );\n\n                if (index < routeLangPart.length) {\n                    parts.push(new UrlGeneratorStringPart(routeLang.substring(index)));\n                }\n\n                if (parts.length === 0) {\n                    throw new Error(routeLangPart);\n                }\n\n                return new UrlGeneratorPartArray(parts);\n            }(routeLang));\n\n            let urlGeneratorParts;\n            if (parent != null) {\n                const parentParts = parent.routes.get(lang).urlGenerator.parts;\n                const mergedParts = parts === null ? parentParts\n                    : new UrlGeneratorPartArray([parentParts, parts]);\n                urlGeneratorParts = new UrlGenerator(mergedParts, extension);\n            } else {\n                urlGeneratorParts = new UrlGenerator(parts, extension);\n            }\n\n            finalRoute.set(lang, new RouterRouteLang(\n                new RegExp(`^${replacedRegExp}${extensionRegExp}${segment ? '(.*)$' : '$'}`),\n                urlGeneratorParts\n            ));\n        });\n\n        return finalRoute;\n    }\n\n    /**\n     * Add default routes\n     */\n    addDefaultRoutes() {\n        this.addSegment('/${controller}', { extension: 'html' }, (segment) => {\n            segment\n                .add('default', '/${action}/*', 'site.index', { extension: 'html' })\n                .defaultRoute('defaultSimple', 'site.index', { extension: 'html' });\n        });\n\n        return this;\n    }\n}\n"]}