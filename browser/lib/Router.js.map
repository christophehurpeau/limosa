{"version":3,"sources":["../../src/Router.js"],"names":[],"mappings":"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","file":"Router.js","sourcesContent":["import RouterRoute from './RouterRoute/Route';\nimport RouterRouteSegment from './RouterRoute/Segment';\nimport Route from './Route';\n\nconst regExpStartingSlash = /^\\/+/;\nconst regExpEndingSlash = /\\/+$/;\n\nexport default class Router {\n    /**\n     * @param {RoutesTranslations} routesTranslations\n     */\n    constructor(routesTranslations) {\n        this._routesMap = new Map();\n        this._routes = [];\n        this._routesTranslations = routesTranslations;\n    }\n\n    /**\n     * Get a Route by its key\n     *\n     * @param {string} key\n     * @return {Route}\n     */\n    get(key) {\n        return this._routesMap.get(key);\n    }\n\n    /**\n     * @param {string} routeKey\n     * @param {RouterRouteCommon} route\n     */\n    addRoute(routeKey, route) {\n        if (route instanceof RouterRoute) {\n            this._addInternalRoute(routeKey, route);\n        }\n\n        this._routes.push(route);\n    }\n\n    /**\n     * @param {string} routeKey\n     * @param {RouterRoute} route\n     */\n    _addInternalRoute(routeKey, route) {\n        this._routesMap.set(routeKey, route);\n    }\n\n    /**\n     * @param {string} path\n     * @param {string=} lang\n     * @return {Route}\n     */\n    find(path, lang = 'en') {\n        path = `/${path.trim().replace(regExpStartingSlash, '').replace(regExpEndingSlash, '')}`;\n        return this._findRoute(this._routes, path, path, lang);\n    }\n\n    /**\n     * @param {Array} routes\n     * @param {string} completePath\n     * @param {string} path\n     * @param {string} lang\n     * @param {Map} namedParams\n     * @return {RouterRoute} route the route or undefined if none found\n     */\n    _findRoute(routes, completePath, path, lang, namedParams) {\n        let result;\n        routes.some((route, index) => {\n            /* RouterRouteLang */\n            let routeLang = route.get(lang);\n            if (!routeLang) {\n                throw new Error(`Cannot find routeLang for lang ${lang} and route ${index}`);\n            }\n\n            if (this.logger) {\n                this.logger.info(`[springbokjs-router] trying ${routeLang.regExp}`);\n            }\n\n            const match = routeLang.match(path);\n            if (!match) {\n                return false;\n            }\n            // console.log(match);\n\n            match.shift(); // remove m[0];\n            let groupCount = match.length;\n\n            if (route instanceof RouterRouteSegment) {\n                const restOfThePath = match[--groupCount];\n\n                // Copy/paste... argh I hate that !\n                if (route.getNamedParamsCount() !== 0) {\n                    // set params\n                    if (!namedParams) {\n                        namedParams = new Map();\n                    }\n\n                    let group = 0;\n                    route.namedParams.forEach((paramName) => {\n                        const value = match[group++];\n                        if (value) {\n                            namedParams.set(paramName, value);\n                        }\n                    });\n                }\n\n                /* if (route.defaultRoute) {\n                    if (restOfThePath.length !== 0) {\n                        result = this._findRoute(route.subRoutes, completePath, restOfThePath, lang, namedParams);\n                    }\n                    if (!result) {\n                        result = this._createRoute(completePath, lang, route.defaultRoute, undefined, 0, namedParams);\n                    }\n                } else {*/\n                result = this._findRoute(route.subRoutes, completePath, restOfThePath, lang, namedParams);\n                // }\n            } else {\n                result = this._createRoute(completePath, lang, route, match, groupCount, namedParams);\n            }\n\n            return true;\n        });\n        return result;\n    }\n\n    /**\n     * Creates a new Route result\n     *\n     * @param {string} completePath\n     * @param {string} lang\n     * @param {RouterRoute} route\n     * @param {Array} match\n     * @param {int} groupCount\n     * @param {Map} namedParams\n     * @return {Route} route\n     */\n    _createRoute(completePath, lang, route, match, groupCount, namedParams) {\n        let group = 0;\n        let extension = groupCount === 0 || !route.extension ? undefined : match[--groupCount];\n\n        let controller = route.controller;\n        let action = route.action;\n\n        let otherParams;\n\n        if (route.getNamedParamsCount() !== 0) {\n            // set params\n            if (!namedParams) {\n                namedParams = new Map();\n            }\n\n            route.namedParams.forEach((paramName) => {\n                const value = match[group++];\n                if (value) {\n                    namedParams.set(paramName, value);\n                }\n            });\n\n            if (!namedParams.size) {\n                namedParams = undefined;\n            }\n        }\n\n        if (namedParams) {\n            // Replace controller and action if needed\n            if (namedParams.has('controller')) {\n                controller = this._routesTranslations.untranslate(namedParams.get('controller'), lang);\n                // Should we remove it ?\n                namedParams.delete('controller');\n            }\n\n            if (namedParams.has('action')) {\n                action = this._routesTranslations.untranslate(namedParams.get('action'), lang);\n                // Should we remove it ?\n                namedParams.delete('action');\n            }\n\n            if (!namedParams.size) {\n                namedParams = undefined;\n            }\n        }\n\n        // The only not-named param can be /*\n        if (group + 1 === groupCount && match[group]) {\n            otherParams = match[group].split('/');\n        }\n\n        return new Route(completePath, controller, action, namedParams, otherParams, extension);\n    }\n\n    /**\n     * Create a link\n     *\n     * @param {string} lang\n     * @param {string} routeKey\n     * @param {string} [params.extension]\n     * @param {string} [params.queryString]\n     * @param {string} [params.hash]\n     * @return {string}\n     */\n    urlGenerator(lang, routeKey, params) {\n        const route = this._routesMap.get(routeKey);\n        return route.routes.get(lang).url(params);\n    }\n}\n"]}